# Lec 14 缓存和高效缓存算法

深入缓存和介绍如何设计高效缓存的算法。

## 总览

- 缓存硬件
- 理想的缓存模型
- 缓存感知算法
  - 分块矩阵乘法
- 缓存无关算法



## 缓存硬件

![image-20240930050033928](http://198.46.215.27:49153/i/66f9bff6f227e.png)

- L1缓存： 每个处理器私有，区分指令和数据的缓存
- L2缓存：同样是处理器私有，不区分
- L3缓存（也称LLC， Last Level Cache），处理器共享，他们都连接到了内存控制器，控制器可以访问DRAM
- 在同一台服务器上，通过网络将一堆多核芯片连接在一起
- **Assoc.** 是 **Associativity（关联度）** 的缩写，表示缓存的**组相联度**。它说明缓存被划分为多少个**组（sets）**，以及每组包含多少个**块（blocks）**
  - 例如，**8-way associativity** 意味着每个组有8个缓存块。更高的关联度可以减少缓存冲突，从而提高命中率

### 全相联缓存

全相联缓存Fully Associative Cache，**一个缓存块可以驻留在缓存的任何地址**。

在下图简化的例子中

- 缓存块（Cache Block）大小 = 4B，字长为4B， 所以每一行地址都对应一个缓存行
- 缓存大小 = 32B
- 每一个缓存行/块都有一个标签，指定了虚拟地址空间的哪一个内存地址。

![image-20240930052808265](/Users/mac/Library/Application%20Support/typora-user-images/image-20240930052808265.png)

要在缓存中找到一个块，必须搜索整个缓存中的标签。当缓存满时，需要将一个块**逐出**以为新块腾出空间。**替换策略**决定要驱逐哪个块。

### 直接映射缓存

直接映射缓存Direct Mapped Cache，