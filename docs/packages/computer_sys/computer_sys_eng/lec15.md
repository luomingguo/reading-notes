# Lec 15 可靠性

作为课程的后半部分，我们将逐渐转向当系统出现失败时候，你该如何处理？即围绕一个框架展开： **如何构建可靠的系统**

办法（这是从很高的角度，细节会因系统而异）：

1. **识别**所有可能的故障，然后决定哪些我们要去解决。
2. 由机制能够**探测/遏制**(限制传播)故障。
3. 处理故障(恢复，"recover")

 还有一个方面，**如何知道系统是可靠的**

最典型的是关注其可用性(availability)，有多大的比例的时间处于运行且可供使用。

MTTF = mean time to failure; Ex 30天

MTTR = mean time to repair; Ex 10分钟

MTBF = MTTF + MTTR = mean time between failure; 43210min

Availability = MTTF / MTBF = 43200 / 43210 = 99.99%

而今天我们主要聚焦处理**磁盘**的故障

----

RAID 技术

Redundant Array of independent disks 冗余独立磁盘阵列

**RAID 1 数据镜像**

<img src="http://198.46.215.27:49153/i/6682b5160e9a3.png" alt="截屏2024-07-01 21.54.23" style="zoom:50%;" />

**特点：**

- 能够从单磁盘故障恢复过来
- 缺点： 但是需要2N个磁盘

---

**RAID 4**

![截屏2024-07-02 00.28.43](http://198.46.215.27:49153/i/6682d942e727e.png)

数据保护是通过奇偶校验（parity）实现的。RAID 4使用一个专门的磁盘来存储奇偶校验信息。当一个磁盘发生故障时，可以利用剩余磁盘上的数据和奇偶校验信息来恢复丢失的数据。

奇偶校验是通过对相应位置的数据扇区进行异或（XOR）操作计算得出的。即：parity = data_disk1 ⊕ data_disk2 ⊕ data_disk3 ⊕ ... ⊕ data_diskN

**恢复过程：**

恢复方法是对剩余磁盘上的第i扇区数据进行异或操作，再与奇偶校验信息进行异或。即：data_Ai = parity ⊕ data_disk1i ⊕ data_disk2i ⊕ ... ⊕ data_disk(N-1)i

特点：

- 能够从单磁盘故障恢复过来
- 只需要N+1个磁盘
- 将单个文件跨多个数据磁盘进行条带化存储（striping）可以带来性能上的好处
  - 当一个文件分成多个数据块并分别存储在多个磁盘上时， 多个磁盘共同分担读写负载，可以并行读写
- 缺点：所有的写操作都会涉及到奇偶校验盘。

---

**RAID 5**

![截屏2024-07-02 00.41.56](/Users/mac/Library/Application%20Support/typora-user-images/%E6%88%AA%E5%B1%8F2024-07-02%2000.41.56.png)

特点：

- 能够从单磁盘故障恢复过来
- 只需要N+1个磁盘
- 将单个文件跨多个数据磁盘进行条带化存储（striping）可以带来性能上的好处
- 写操作分布在多个磁盘上，从而避免单个磁盘成为性能瓶颈。

冷知识， RAID6可以应对多个硬盘故障的情况。

----

系统总是会有故障，要构建可靠，容错系统的系统我们必须将它们考虑在内。可靠性会带来一些消耗，就有了可靠性和简便性的权衡，可靠性与性能的权衡。我们的提升可靠性的主要工具，就是冗余。其中一种冗余的形式就是复制/副本。

